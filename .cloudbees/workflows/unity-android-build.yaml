apiVersion: automation.cloudbees.io/v1alpha1
kind: workflow
name: Unity Version Check

on:
  push:
    branches:
      - 'main'

jobs:
  unity-version:
    steps:
      - name: Checkout code
        uses: cloudbees-io/checkout@v1

      - name: Check Unity Version
        uses: docker://unityci/editor:ubuntu-6000.0.49f1-android-3.1.0
        shell: sh
        run: |
          echo "üîç Unity Version:"
          unity-editor --version
          
      - name: Build Unity APK
        uses: docker://unityci/editor:ubuntu-6000.0.49f1-android-3.1.0
        shell: sh
        env:
          UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
          UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
        run: |
          echo "üì¶ Build APK..."
          mkdir -p Builds/Android
          unity-editor \
          -batchmode \
          -nographics \
          -projectPath . \
          -logFile build.log \
          -executeMethod BuildScript.Build \
          -quit || (cat build.log && exit 1)
